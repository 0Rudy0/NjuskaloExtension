function createCsvOfSqlData(){var n=openDatabase("Njuskalo","1.0","Njuskalo pracenje cijena oglasa",2097152);n.transaction(function(n){n.executeSql("SELECT rowId, * FROM PriceHistory",[],function(n,t){var i,u,r;for(console.log("price history count: "+t.rows.length),i=[],i.push(["Advert id","Price HRK","Price EUR","Date"]),u=0;u<t.rows.length;u++)r=t.rows[u],i.push([r.advertId,r.priceHRK,r.priceEUR,r.date]);exportToCsv("PriceHistory"+customDateString()+"(_"+i.length+").csv",i)},function(n,t){log("error fetching PriceHistory");logObj(t)});for(var t=(new Date).getTime()+1e3;(new Date).getTime()<=t;);n.executeSql("SELECT rowId, * FROM Advert",[],function(n,t){var r,u,i;for(console.log("adverts count: "+t.rows.length),r=[],r.push(["Advert ID","Date last viewed","Date first viewed","Title","Main Description","username"]),u=0;u<t.rows.length;u++){for(i=t.rows[u];i.title.indexOf(";")>-1||i.title.indexOf(",")>-1;)i.title=i.title.replace(";","_"),i.title=i.title.replace(",",".");while(i.mainDesc.indexOf(";")>-1||i.mainDesc.indexOf(",")>-1)i.mainDesc=i.mainDesc.replace(";","_"),i.mainDesc=i.mainDesc.replace(",",".");r.push([i.advertId,i.dateLastViewed,i.dateFirstViewed,i.title,i.mainDesc,i.username])}exportToCsv("Adverts"+customDateString()+"_("+r.length+").csv",r);localStorage.setItem("lastBackupDateNjuskalo",(new Date).getTime())},function(n,t){log("error fetching Adverts");logObj(t)});setTimeout(function(){},2e3)})}function exportToCsv(n,t){for(var f,i,s,r,e,u="",o=0;o<t.length;o++){for(f=t[o],i=0;i<f.length;i++)s=f[i]==null?"":f[i].toString(),r=s.replace(/"/g,'""'),r.search(/("|,|\n)/g)>=0&&(r='"'+r+'"'),i>0&&(u+=";"),u+=r;u+="\n"}e=document.createElement("a");e.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(u));e.setAttribute("download",n);e.click()}function stringifyAndExport(n){var t=document.createElement("a");t.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent("var solarData = "+JSON.stringify(n)));t.setAttribute("download","jsonData_"+customDateString()+";("+n.length+").js");t.click()}function customDateString(){var n=new Date;return"["+(n.getFullYear()+"."+(n.getMonth()+1).pad(2)+"."+n.getDate().pad(2)+"]-"+n.getHours().pad(2)+"_"+n.getMinutes().pad(2))}Number.prototype.pad=function(n){for(var t=String(this);t.length<(n||2);)t="0"+t;return t};